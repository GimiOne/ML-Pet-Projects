# Генерация музыкальных произведений с помощью нейронной сети LSTM

## О проекте

Это pet-проект, демонстрирующий возможности глубокого обучения в области генеративной музыки. Используя рекуррентную нейронную сеть с долгосрочной краткосрочной памятью (LSTM), модель обучена на произведениях Фредерика Шопена для создания музыкальных композиций в его стиле. Для начальных последовательностей использованы произведения Вольфганга Амадея Моцарта, что позволяет генерировать уникальные музыкальные фрагменты с элементами стилистического разнообразия. Проект включает в себя обработку MIDI-файлов, обучение модели, генерацию музыки с использованием параметра температуры для управления креативностью, а также визуализацию нотного стана и воспроизведение аудио.

## Цели проекта

- **Обучение модели**: Создание и обучение LSTM-нейронной сети для генерации музыки на основе MIDI-данных произведений Шопена.
- **Гибкость генерации**: Реализация функции генерации музыки с параметром температуры для контроля степени случайности и творческого разнообразия.
- **Интеграция данных**: Использование произведений Моцарта для начальных последовательностей, чтобы добавить уникальность в сгенерированные композиции.
- **Визуализация и воспроизведение**: Создание нотного стана и аудиофайла для демонстрации результатов генерации.

## Технологии и библиотеки

Проект реализован с использованием следующих инструментов и библиотек:

- **Python**: Основной язык программирования.
- **TensorFlow/Keras**: Для построения и обучения LSTM-нейронной сети.
- **Music21**: Для обработки MIDI-файлов, извлечения нот и аккордов, а также визуализации нотного стана.
- **Pretty_MIDI**: Для работы с MIDI-данными.
- **FluidSynth**: Для воспроизведения сгенерированных MIDI-файлов.
- **NumPy**: Для обработки числовых данных и подготовки входных последовательностей.
- **Matplotlib**: Для визуализации метрик обучения (точность и потери).
- **MuseScore**: Для отображения нотного стана.
- **Scikit-learn**: Для разделения данных на обучающую и тестовую выборки.

## Установка

Для запуска проекта необходимо установить зависимости и настроить окружение. Пример команд для установки:

```bash
sudo apt install -y fluidsynth
pip install --upgrade pyfluidsynth
add-apt-repository -y ppa:mscore-ubuntu/mscore3-stable
apt-get update
apt-get install musescore3
pip install -U music21==9.1.0
apt-get install xvfb
pip install numpy tensorflow pretty_midi
```

Также необходимо настроить пути для `music21`:

```python
from music21 import environment
us = environment.UserSettings()
us['musescoreDirectPNGPath'] = '/usr/bin/mscore3'
us['directoryScratch'] = '/tmp'
```

## Датасет

Проект использует датасет MIDI-файлов классической музыки, содержащий произведения Шопена и Моцарта. Датасет загружается и распаковывается следующим образом:

```bash
wget https://storage.yandexcloud.net/academy.ai/classical-music-midi.zip
unzip -qo "classical-music-midi.zip" -d ./dataset
```

- **Шопен**: Используется для обучения модели, чтобы генерировать музыку в его стиле.
- **Моцарт**: Используется для создания начальных последовательностей, добавляющих разнообразие.

## Структура проекта

1. **Загрузка и обработка данных**:

   - MIDI-файлы парсятся с помощью библиотеки `music21`.
   - Извлекаются ноты и аккорды, формируется корпус нот.
   - Удаляются редкие ноты (встречающиеся менее 100 раз) для оптимизации словаря.
   - Создается словарь для мэппинга нот на числовые индексы и обратно.

2. **Подготовка данных**:

   - Формируются последовательности фиксированной длины (40 нот) для обучения.
   - Данные нормализуются и преобразуются в формат, подходящий для LSTM.

3. **Архитектура модели**:

   - Используется последовательная модель `Sequential` из Keras.
   - Слои:
     - Входной слой (`Input`) с формой (40, 1).
     - Два слоя LSTM (256 и 128 нейронов) для обработки последовательностей.
     - Слои `Dropout` (0.1) для предотвращения переобучения.
     - Полносвязные слои (`Dense`) для классификации следующей ноты.
   - Модель компилируется с оптимизатором `Adam` и функцией потерь `categorical_crossentropy`.

4. **Обучение**:

   - Модель обучается на данных Шопена (80% обучающая выборка, 20% тестовая).
   - Параметры: 100 эпох, размер батча 256.
   - Визуализируются графики точности и потерь.

5. **Генерация музыки**:

   - Реализована функция `music_generator` с параметром температуры, управляющим степенью случайности.
   - Начальные последовательности берутся из произведений Моцарта.
   - Сгенерированные ноты преобразуются в MIDI-поток с помощью `music21`.

6. **Визуализация и воспроизведение**:

   - Нотный стан отображается с помощью `MuseScore`.
   - MIDI-файл воспроизводится через `FluidSynth`.

## Использование

1. Установите зависимости и настройте окружение, как описано выше.
2. Загрузите и распакуйте датасет.
3. Запустите скрипт для обучения модели и генерации музыки:

```python
# Пример запуска генерации
genMusic = music_generator(100, temperature=1.5)
genMidi = stream.Stream(genMusic)
genMidi.show()  # Показать нотный стан
genMidi.show('midi')  # Воспроизвести аудио
```

Параметр `temperature` позволяет управлять стилем генерации:

- Низкая температура (например, 0.5): Более предсказуемые и близкие к стилю Шопена композиции.
- Высокая температура (например, 1.5): Более случайные и творческие результаты.

## Результаты

- **Обученная модель**: LSTM-модель успешно обучается на произведениях Шопена, демонстрируя высокую точность на обучающей выборке.
- **Генерация музыки**: Сгенерированные композиции сохраняют стилистические черты Шопена, но с элементами вариативности благодаря начальным последовательностям Моцарта.
- **Визуализация**: Нотный стан и аудиофайл позволяют оценить качество сгенерированной музыки.

## Перспективы

В будущем проект можно расширить:

- Добавлением поддержки других композиторов.
- Улучшением архитектуры модели (например, использование Transformer или GAN).
- Интеграцией интерфейса для интерактивной генерации музыки.
